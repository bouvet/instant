<table mat-table #table [dataSource]="dataSource" matSort>
  <ng-container *ngFor="let col of columns; let i = index" [matColumnDef]="col.name" [sticky]="col.sticky">
    <!-- Header definition -->
    <th mat-header-cell *matHeaderCellDef [ngStyle]="col.instantStyle">
      <header>
        <div class="action" *ngIf="col.filterable != false">
          <mat-menu #appMenu="matMenu">
            <ng-container *ngIf="col.filterRef; else defaultFilterTemplate">
              <ng-container *ngTemplateOutlet="col.filterRef;context:{col:col}"></ng-container>
            </ng-container>

            <ng-template #defaultFilterTemplate>
              <mat-form-field class="no-padding">
                <input matInput placeholder="Filter" (click)="$event.stopPropagation()" (keyup)="checkClose($event, menuTrigger)"  [(ngModel)]="col.filterValue" [ngModelOptions]="{standalone:true}" (change)="col.setFilter(col.filterValue)">
                <button mat-icon-button matSuffix (click)="col.setFilter(undefined)">
                  <i class="fa far fa-times fa-fw"></i>
                </button>
              </mat-form-field>
            </ng-template>
          </mat-menu>
          <button mat-icon-button [matMenuTriggerFor]="appMenu" #menuTrigger="matMenuTrigger">
            <ng-container *ngIf="col.filterValue == null || col.filterValue == ''">
              <svg class="filter-icon no-filter-set" data-name="No filter set" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24.06 24.12">
                <title>No filter set</title>
                <polygon class="cls-1" points="10.3 19.93 10.3 12.94 4.46 5.87 19.43 5.87 13.58 13.05 13.58 19.93 10.3 19.93"
                />
                <path class="cls-2" d="M18.48,6.32l-5.15,6.32-.2.25v6.58H10.75V12.78l-.21-.26L5.42,6.32H18.48m1.9-.9H3.5L9.84,13.1v7.28H14V13.21l6.35-7.79Z"
                />
              </svg>
            </ng-container>
            <ng-container *ngIf="col.filterValue != null && col.filterValue != ''">
              <svg class="filter-icon filter-set" data-name="Filter set" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24.06 24.12">
                <title>Filter set</title>
                <polygon class="cls-2" points="20.3 5.42 3.42 5.42 9.77 13.1 9.77 20.38 13.96 20.38 13.96 13.21 20.3 5.42"
                />
              </svg>
            </ng-container>
          </button>
        </div>
        <div class="flex-col" role="heading" *ngIf="i===0">
            <button mat-icon-button [matMenuTriggerFor]="clearmenu" class="mat-icon-button-ellipsis"><i style="color: #000" class="fa fa-fw fa-ellipsis-v"></i></button>
            <mat-menu #clearmenu="matMenu" [overlapTrigger]="false">
                <button mat-menu-item class="mat-menu-item" (click)="reload()">
                    <span class="fa fa-refresh"></span>
                    <span>Refresh</span>
                </button>
                <button mat-menu-item class="mat-menu-item" (click)="removeFilters()">
                    <span class="fa fa-filter"></span>
                     <span>Clear filter</span>
                </button>
            </mat-menu>
        </div>
        <div mat-sort-header class="flex-col" role="heading" *ngIf="i!=0 && col.sortable != false">
          {{ col.label }}
        </div>
        <div class="flex-col" role="heading" *ngIf="i!=0 && col.sortable == false">
          {{ col.label }}
        </div>
      </header>
    </th>

    <!-- Cell definition -->
    <td mat-cell *matCellDef="let element">
      <ng-container *ngIf="col.cellRef; else defaultCellTemplate">
        <ng-container *ngTemplateOutlet="col.cellRef;context:{row:element,col:col.name}"></ng-container>
      </ng-container>

      <ng-template #defaultCellTemplate>
        {{ element[col.name] }}
      </ng-template>
    </td>
  </ng-container>
  <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: sticky"></tr>
  <tr mat-row *matRowDef="let row; columns: displayedColumns;let index=index;"
           [ngClass]="getRowClasses(index)"
           [ngStyle]="getRowStyles(index)"
           [attr.data-rowIndex]="index"
           (click)="onRowClicked(row, $event)"></tr>
</table>
