!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("rxjs"),require("element-closest"),require("@angular/material"),require("@angular/common"),require("@angular/forms"),require("@angular/cdk/collections"),require("@angular/router"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("instant",["exports","@angular/core","rxjs","element-closest","@angular/material","@angular/common","@angular/forms","@angular/cdk/collections","@angular/router","rxjs/operators"],e):e(t.instant={},t.ng.core,t.rxjs,null,t.ng.material,t.ng.common,t.ng.forms,t.ng.cdk.collections,t.ng.router,t.rxjs.operators)}(this,function(t,e,o,n,r,a,i,l,d,s){"use strict";var c=function(t,e){return(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function u(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var o,r,a=n.call(t),i=[];try{for(;(void 0===e||0<e--)&&!(o=a.next()).done;)i.push(o.value)}catch(l){r={error:l}}finally{try{o&&!o.done&&(n=a["return"])&&n.call(a)}finally{if(r)throw r.error}}return i}var p=function(){function t(){this.filterable=!0,this.sortable=!0,this.sticky=!1,this.instantStyle={},this.filter=new o.ReplaySubject}return t.prototype.ngOnInit=function(){null==this.label&&(this.label=this.name)},t.prototype.setFilter=function(t,e){void 0===e&&(e=!1),t!==this.oldFilter&&(e||this.filter.next({active:this.name,filter:t}),this.filterValue=t,this.oldFilter=t),this.filterOpen=!1},t.prototype.removeFilter=function(){this.setFilter(null)},t.decorators=[{type:e.Directive,args:[{selector:"instant-column"}]}],t.ctorParameters=function(){return[]},t.propDecorators={name:[{type:e.Input}],label:[{type:e.Input}],filterable:[{type:e.Input}],sortable:[{type:e.Input}],sticky:[{type:e.Input}],instantStyle:[{type:e.Input,args:["instant-style"]}],filterRef:[{type:e.ContentChild,args:["filter"]}],cellRef:[{type:e.ContentChild,args:["cell"]}]},t}(),f=function(){function t(t){this.elRef=t,this.rowClicked=new e.EventEmitter}return Object.defineProperty(t.prototype,"displayedColumns",{get:function(){return this._displayedColumns=this._displayedColumns||(this.columns?this.columns.map(function(t){return t.name}):null)},set:function(t){this._displayedColumns=t},enumerable:!0,configurable:!0}),t.prototype.ngAfterContentInit=function(){this.columns&&this.columns.length&&this.dataSource.db._configure({sortChange:this.sort.sortChange,filterChange:o.merge.apply(void 0,function n(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(u(arguments[e]));return t}(this.columns.map(function(t){return t.filter})))})},t.prototype.ngOnDestroy=function(){this.subscriptions&&this.subscriptions.length&&this.subscriptions.map(function(t){return t.unsubscribe()})},t.prototype.onRowClicked=function(t,e){if(null===e.target.closest("instant-grid-row-menu")){var n=[].slice.call(e.target.closest("td").classList).find(function(t){return-1<t.indexOf("mat-column-")}).substr("mat-column-".length);this.rowClicked.emit({data:t,colName:n})}},t.prototype.onClick=function(e){var n=[].slice.call(this.elRef.nativeElement.querySelectorAll("th")).filter(function(t){return!t.contains(e.target)}).map(function(t){return[].slice.call(t.classList).find(function(t){return-1<t.indexOf("mat-column-")}).substr("mat-column-".length)});this.columns.filter(function(t){return n.includes(t.name)}).forEach(function(t){return t.filterOpen=!1})},t.prototype.checkClose=function(t,e){"Enter"===t.key&&e.closeMenu()},t.prototype.getRowClasses=function(t){var e=[];if(t===this.selectedIndex&&e.push("highlight"),this.rowAttributes&&0<this.rowAttributes.length)for(var n=this.rowAttributes,o=0;o<n.length;o++)n[o].index===t&&n[o]["class"]&&0<n[o]["class"].length&&(e=e.concat(n[o]["class"]));return e.join(" ")},t.prototype.getRowStyles=function(t){var e=[];if(this.rowAttributes&&0<this.rowAttributes.length)for(var n=this.rowAttributes,o=0;o<n.length;o++)n[o].index===t&&n[o].style&&0<n[o].style.length&&(e=e.concat(n[o].style));return e.join(" ")},t.prototype.removeFilters=function(){this.columns.forEach(function(t){t.removeFilter()})},t.prototype.reload=function(){this.columns.forEach(function(t,e){0==e&&t.setFilter(undefined)})},t.decorators=[{type:e.Component,args:[{selector:"instant-grid",template:'<table mat-table #table [dataSource]="dataSource" matSort>\n  <ng-container *ngFor="let col of columns; let i = index" [matColumnDef]="col.name" [sticky]="col.sticky">\n    \x3c!-- Header definition --\x3e\n    <th mat-header-cell *matHeaderCellDef [ngStyle]="col.instantStyle">\n      <header>\n        <div class="action" *ngIf="col.filterable != false">\n          <mat-menu #appMenu="matMenu">\n            <ng-container *ngIf="col.filterRef; else defaultFilterTemplate">\n              <ng-container *ngTemplateOutlet="col.filterRef;context:{col:col}"></ng-container>\n            </ng-container>\n\n            <ng-template #defaultFilterTemplate>\n              <mat-form-field class="no-padding">\n                <input matInput placeholder="Filter" (click)="$event.stopPropagation()" (keyup)="checkClose($event, menuTrigger)"  [(ngModel)]="col.filterValue" [ngModelOptions]="{standalone:true}" (change)="col.setFilter(col.filterValue)">\n                <button mat-icon-button matSuffix (click)="col.setFilter(undefined)">\n                  <i class="fa far fa-times fa-fw"></i>\n                </button>\n              </mat-form-field>\n            </ng-template>\n          </mat-menu>\n          <button mat-icon-button [matMenuTriggerFor]="appMenu" #menuTrigger="matMenuTrigger">\n            <ng-container *ngIf="col.filterValue == null || col.filterValue == \'\'">\n              <svg class="filter-icon no-filter-set" data-name="No filter set" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24.06 24.12">\n                <title>No filter set</title>\n                <polygon class="cls-1" points="10.3 19.93 10.3 12.94 4.46 5.87 19.43 5.87 13.58 13.05 13.58 19.93 10.3 19.93"\n                />\n                <path class="cls-2" d="M18.48,6.32l-5.15,6.32-.2.25v6.58H10.75V12.78l-.21-.26L5.42,6.32H18.48m1.9-.9H3.5L9.84,13.1v7.28H14V13.21l6.35-7.79Z"\n                />\n              </svg>\n            </ng-container>\n            <ng-container *ngIf="col.filterValue != null && col.filterValue != \'\'">\n              <svg class="filter-icon filter-set" data-name="Filter set" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24.06 24.12">\n                <title>Filter set</title>\n                <polygon class="cls-2" points="20.3 5.42 3.42 5.42 9.77 13.1 9.77 20.38 13.96 20.38 13.96 13.21 20.3 5.42"\n                />\n              </svg>\n            </ng-container>\n          </button>\n        </div>\n        <div class="flex-col" role="heading" *ngIf="i===0">\n            <button mat-icon-button [matMenuTriggerFor]="clearmenu" class="mat-icon-button-ellipsis"><i style="color: #000" class="fa fa-fw fa-ellipsis-v"></i></button>\n            <mat-menu #clearmenu="matMenu" [overlapTrigger]="false">\n                <button mat-menu-item class="mat-menu-item" (click)="reload()">\n                    <span class="fa fa-refresh"></span>\n                    <span>Refresh</span>\n                </button>\n                <button mat-menu-item class="mat-menu-item" (click)="removeFilters()">\n                    <span class="fa fa-filter"></span>\n                     <span>Clear filter</span>\n                </button>\n            </mat-menu>\n        </div>\n        <div mat-sort-header class="flex-col" role="heading" *ngIf="i!=0 && col.sortable != false">\n          {{ col.label }}\n        </div>\n        <div class="flex-col" role="heading" *ngIf="i!=0 && col.sortable == false">\n          {{ col.label }}\n        </div>\n      </header>\n    </th>\n\n    \x3c!-- Cell definition --\x3e\n    <td mat-cell *matCellDef="let element">\n      <ng-container *ngIf="col.cellRef; else defaultCellTemplate">\n        <ng-container *ngTemplateOutlet="col.cellRef;context:{row:element,col:col.name}"></ng-container>\n      </ng-container>\n\n      <ng-template #defaultCellTemplate>\n        {{ element[col.name] }}\n      </ng-template>\n    </td>\n  </ng-container>\n  <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: sticky"></tr>\n  <tr mat-row *matRowDef="let row; columns: displayedColumns;let index=index;"\n           [ngClass]="getRowClasses(index)"\n           [ngStyle]="getRowStyles(index)"\n           [attr.data-rowIndex]="index"\n           (click)="onRowClicked(row, $event)"></tr>\n</table>\n',styles:["[role=columnheader] header{position:relative;display:flex;align-items:center}[role=columnheader]:hover .action>button{visibility:visible}[role=columnheader] [role=heading]{flex:1}:host.striped [role=row]{background:#fff}:host.striped [role=row]:nth-child(even){background:#fefefe}::ng-deep .mat-table{display:table!important;width:100%}::ng-deep .mat-table>.mat-header-row,::ng-deep .mat-table>.mat-row{display:table-row;padding:0;border:none}::ng-deep .mat-table>.mat-header-row>.mat-cell,::ng-deep .mat-table>.mat-header-row>.mat-header-cell,::ng-deep .mat-table>.mat-row>.mat-cell,::ng-deep .mat-table>.mat-row>.mat-header-cell{display:table-cell;height:48px;vertical-align:middle;border-bottom:1px solid rgba(0,0,0,.12);padding-left:3px}::ng-deep .mat-table>.mat-header-row>.mat-cell,::ng-deep .mat-table>.mat-row>.mat-cell{border-left:1px solid rgba(0,0,0,.12)}::ng-deep .no-padding{max-height:3rem;padding:0 16px;overflow:hidden}::ng-deep .mat-column-actions{overflow:initial}::ng-deep .mat-column-actions .mat-card,::ng-deep .mat-column-actions mat-card{position:absolute}.action mat-menu{padding:0}.action mat-menu mat-form-field{width:100%;padding:0;margin:0}.mat-icon-button{width:18px}.mat-icon-button-ellipsis{width:40px}.filter-icon .cls-1{fill:#fff}.filter-icon .cls-2{fill:#1d1d1b}"]}]}],t.ctorParameters=function(){return[{type:e.ElementRef}]},t.propDecorators={dataSource:[{type:e.Input}],selectedIndex:[{type:e.Input}],sticky:[{type:e.Input}],rowAttributes:[{type:e.Input}],columns:[{type:e.ContentChildren,args:[p]}],rowClicked:[{type:e.Output}],sort:[{type:e.ViewChild,args:[r.MatSort]}],displayedColumns:[{type:e.Input}],onClick:[{type:e.HostListener,args:["document:click",["$event"]]}]},t}(),m=function(){function t(){this.page=0,this.pageChange=new e.EventEmitter,this.total=0,this.pageSize=10,this.pageSizeOptions=[5,10,25,100]}return t.prototype.ngOnInit=function(){},t.prototype.pageHandler=function(t){this.pageSize=t.pageSize,this.page=t.pageIndex,this.pageChange.emit(t)},t.decorators=[{type:e.Component,args:[{selector:"instant-grid-toolbar",template:'<mat-toolbar>\n  <header>\n    <ng-content></ng-content>\n  </header>\n  <mat-paginator [length]="total" [pageSize]="pageSize" (page)="pageHandler($event)" [pageSizeOptions]="pageSizeOptions"> </mat-paginator>\n</mat-toolbar>\n',styles:["mat-toolbar header{flex:1}.mat-paginator{background:0 0}"]}]}],t.ctorParameters=function(){return[]},t.propDecorators={page:[{type:e.Input}],pageChange:[{type:e.Output}],total:[{type:e.Input}],pageSize:[{type:e.Input}],pageSizeOptions:[{type:e.Input}]},t}(),g=function(){function t(t){this.grid=t,this.icon="ellipsis-v",this.showMenu=!1}return t.prototype.ngOnInit=function(){},t.prototype.onClick=function(e){var o=this;[].slice.call(this.grid.elRef.nativeElement.querySelectorAll("mat-cell.mat-column-actions")).filter(function(t){return!t.contains(e.target)}).forEach(function(t){var e=t.closest("mat-row"),n=[].slice.call(e.closest("mat-table").children).indexOf(e)-1;o.grid.dataSource.db.dataSnapshot[n].showMenu=!1})},t.decorators=[{type:e.Component,args:[{selector:"instant-grid-row-menu",template:'<mat-menu #rowMenu="matMenu">\n  <ng-content></ng-content>\n</mat-menu>\n\n<button type="button" mat-icon-button [matMenuTriggerFor]="rowMenu">\n  <i class="fa far fa-fw fa-{{ icon }}"></i>\n</button>\n',styles:[":host{position:relative}mat-card{position:absolute;z-index:100;right:0}"]}]}],t.ctorParameters=function(){return[{type:f}]},t.propDecorators={row:[{type:e.Input}],icon:[{type:e.Input}],onClick:[{type:e.HostListener,args:["document:click",["$event"]]}]},t}(),h=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{imports:[a.CommonModule,i.FormsModule,r.MatTableModule,r.MatSortModule,r.MatInputModule,r.MatCardModule,r.MatMenuModule,r.MatButtonModule,r.MatToolbarModule,r.MatPaginatorModule],declarations:[f,p,m,g],exports:[f,p,m,g]}]}],t}(),b=function(n){function t(t){var e=n.call(this)||this;return e.db=t,e}return function o(t,e){function n(){this.constructor=t}c(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(t,n),t.prototype.connect=function(){return this.db.dataChange},t.prototype.disconnect=function(){this.db.onDestroy()},t}(l.DataSource),y=function(){function t(){var r,a,i,l;this.sortCache={},this.filterChange=new o.BehaviorSubject(null),this.filterCache={},this.dataChange=new o.BehaviorSubject([]),this.dataReader=(r=this.onRead,void 0===(a=100)&&(a=300),void 0===i&&(i=!1),function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this,o=i&&!l;clearTimeout(l),l=setTimeout(function(){l=null,i||r.apply(n,t)},a),o&&r.apply(n,t)})}return t.prototype.onInit=function(){var e=this;this.onRead(),this._dataChangeSubscriber=this.dataChange.subscribe(function(t){return e.dataSnapshot=t})},t.prototype.onDestroy=function(){this._dataChangeSubscriber.unsubscribe(),this._sortSubscriber.unsubscribe(),this._filterSubscriber.unsubscribe()},t.prototype.onRead=function(t,e){},t.prototype._configure=function(t){var e=this;Object.assign(this,t),this._sortSubscriber=this.sortChange.subscribe(function(t){e.sortCache={},e.sortCache[t.active]=t.direction,e.dataReader(e.sortCache,e.filterCache)}),this._filterSubscriber=this.filterChange.subscribe(function(t){e.filterCache[t.active]=t.filter,e.dataReader(e.sortCache,e.filterCache)}),this.onInit&&this.onInit()},t}(),v=function(){function t(t,e){this.route=t,this.router=e,this.subscriptions=[]}return t.prototype.ngOnInit=function(){var n=this;this.subscriptions.push(this.router.events.pipe(s.filter(function(t){return t instanceof d.NavigationEnd})).subscribe(function(t){console.log("url changed");var e=n.route.root;n.routeMap=n.getBreadcrumbs(e)}))},t.prototype.ngOnDestroy=function(){this.subscriptions.forEach(function(t){t&&t.unsubscribe()})},t.prototype.getBreadcrumbs=function(t,e,n){var o,r;void 0===e&&(e=""),void 0===n&&(n=[]);var a="breadcrumb",i=t.children;if(0===i.length)return n;try{for(var l=function p(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}(i),s=l.next();!s.done;s=l.next()){var c=s.value;if(c.outlet===d.PRIMARY_OUTLET){if(!c.snapshot.data.hasOwnProperty(a))return this.getBreadcrumbs(c,e,n);e+="/"+c.snapshot.url.map(function(t){return t.path}).join("/");var u={label:c.snapshot.data[a],params:c.snapshot.params,url:e};return n.push(u),this.getBreadcrumbs(c,e,n)}}}catch(f){o={error:f}}finally{try{s&&!s.done&&(r=l["return"])&&r.call(l)}finally{if(o)throw o.error}}},t.decorators=[{type:e.Component,args:[{selector:"instant-breadcrumb",template:'<a [routerLink]="[\'/\']"><i class="fa far fa-fw fa-home"></i></a>\n<a *ngFor="let route of routeMap" [routerLink]="[route.url]">{{ route.label }}</a>\n',styles:[":host{flex:1}"]}]}],t.ctorParameters=function(){return[{type:d.ActivatedRoute},{type:d.Router}]},t}(),w=function(){function t(){}return t.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[]},t.ngInjectableDef=e.defineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t}(),C=function(){function t(t){this.toolbarService=t}return Object.defineProperty(t.prototype,"actionsRef",{get:function(){return this.toolbarService.actionTemplate},enumerable:!0,configurable:!0}),t.decorators=[{type:e.Component,args:[{selector:"instant-form-actions",template:'<ng-container *ngIf="actionsRef; else defaultTemplate">\n  <ng-container *ngTemplateOutlet="actionsRef"></ng-container>\n</ng-container>\n\n<ng-template #defaultTemplate></ng-template>\n',styles:[""]}]}],t.ctorParameters=function(){return[{type:w}]},t}(),x=function(){function t(t,e){this.template=t,this.toolbar=e}return t.prototype.ngOnInit=function(){this.toolbar.actionTemplate=this.template},t.prototype.ngOnDestroy=function(){this.toolbar.actionTemplate=null},t.decorators=[{type:e.Directive,args:[{selector:"[instantFormActionsDef]"}]}],t.ctorParameters=function(){return[{type:e.TemplateRef},{type:w}]},t}(),I=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{imports:[a.CommonModule,d.RouterModule],declarations:[v,C,x],exports:[v,C,x],providers:[w]}]}],t}();t.GridModule=h,t.GridComponent=f,t.ColumnDirective=p,t.GridRowMenuComponent=g,t.InstantDataSource=b,t.InstantDatabase=y,t.ToolbarModule=I,t.BreadcrumbComponent=v,t.FormActionsComponent=C,t.FormActionsDefDirective=x,t.ToolbarService=w,t.Éµa=m,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=instant.umd.min.js.map